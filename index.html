<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Dashboard de Sprint Review pour Ã©quipes Agile - Visualisation des mÃ©triques et forecast">
  <meta name="theme-color" content="#2563eb">

  <title>Sprint Review Dashboard</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <!-- Design System -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">

  <!-- Components -->
  <link rel="stylesheet" href="css/components/card.css">
  <link rel="stylesheet" href="css/components/button.css">
  <link rel="stylesheet" href="css/components/input.css">
  <link rel="stylesheet" href="css/components/badge.css">
  <link rel="stylesheet" href="css/components/gauge.css">
  <link rel="stylesheet" href="css/components/empty-state.css">
  <link rel="stylesheet" href="css/components/toggle.css">
  <link rel="stylesheet" href="css/components/file-upload.css">
  <link rel="stylesheet" href="css/components/charts.css">
  <link rel="stylesheet" href="css/components/loader.css">
  <link rel="stylesheet" href="css/components/navigation.css">

  <!-- Pages -->
  <link rel="stylesheet" href="css/pages/admin.css">
  <link rel="stylesheet" href="css/pages/review.css">
  <link rel="stylesheet" href="css/pages/forecast.css">
  <link rel="stylesheet" href="css/pages/shared.css">
  <link rel="stylesheet" href="css/pages/howmany.css">

  <!-- External Libraries -->
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- Chart.js Annotation Plugin (pour les lignes de benchmark) -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
  <!-- html2canvas (pour l'export PDF) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- jsPDF (pour l'export PDF) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Application Container -->
  <div id="app" class="app">

    <!-- Header avec Navigation intÃ©grÃ©e -->
    <header id="app-header" class="header">
      <div class="header__brand">
        <h1 class="header__title">Sprint Review</h1>
      </div>

      <!-- Navigation intÃ©grÃ©e dans le header -->
      <nav id="app-nav" class="header__nav">
        <!-- Navigation Component sera montÃ© ici -->
      </nav>

      <div class="header__info">
        <span class="header__sprint" id="header-sprint-info">
          <!-- Rempli dynamiquement -->
        </span>
        <button class="header__info-btn" id="rgpd-info-btn" title="ConformitÃ© RGPD" aria-label="Informations RGPD">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Modal RGPD -->
    <div class="modal-overlay" id="rgpd-modal">
      <div class="modal" role="dialog" aria-labelledby="modal-title" aria-modal="true">
        <div class="modal__header">
          <h2 class="modal__title" id="modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
            ConformitÃ© RGPD
          </h2>
          <button class="modal__close" id="rgpd-modal-close" aria-label="Fermer">&times;</button>
        </div>
        <div class="modal__body">
          <h2>1. RÃ©sumÃ© exÃ©cutif</h2>
          <p>Le Sprint Review Dashboard est une application <strong>100% client-side</strong> (sans serveur) qui traite des donnÃ©es exportÃ©es depuis Jira pour visualiser les mÃ©triques d'Ã©quipe Agile. L'application prÃ©sente un <strong>risque RGPD faible</strong> en raison de son architecture locale.</p>

          <table>
            <thead>
              <tr><th>CritÃ¨re</th><th>Statut</th></tr>
            </thead>
            <tbody>
              <tr><td>Minimisation des donnÃ©es</td><td>Conforme</td></tr>
              <tr><td>Stockage local uniquement</td><td>Conforme</td></tr>
              <tr><td>Pas de transfert externe</td><td>Conforme</td></tr>
              <tr><td>Traitement de donnÃ©es personnelles</td><td>Conforme</td></tr>
              <tr><td>Droit Ã  l'effacement</td><td>Conforme</td></tr>
            </tbody>
          </table>

          <h2>2. DonnÃ©es traitÃ©es</h2>
          <h3>DonnÃ©es non personnelles</h3>
          <ul>
            <li>Identifiants de tickets (PHX-101, etc.)</li>
            <li>Types de tickets (Story, Bug, Task)</li>
            <li>Statuts (To Do, In Progress, Done)</li>
            <li>Story Points, Noms de sprints</li>
            <li>Dates de crÃ©ation/rÃ©solution</li>
            <li>Temps passÃ© dans chaque statut</li>
          </ul>

          <h3>DonnÃ©es personnelles (Article 4 RGPD)</h3>
          <table>
            <thead>
              <tr><th>DonnÃ©e</th><th>CatÃ©gorie</th><th>SensibilitÃ©</th></tr>
            </thead>
            <tbody>
              <tr><td>Nom de l'assignÃ©</td><td>DonnÃ©e d'identification</td><td>Faible</td></tr>
              <tr><td>Performance individuelle</td><td>DonnÃ©e dÃ©rivÃ©e</td><td>Moyenne</td></tr>
              <tr><td>VÃ©locitÃ© par contributeur</td><td>DonnÃ©e dÃ©rivÃ©e</td><td>Moyenne</td></tr>
            </tbody>
          </table>
          <p><strong>Note</strong> : ces donnÃ©es sont dissimulÃ©es mais contenues dans le rapport EazyBI.</p>

          <h2>3. Architecture et flux de donnÃ©es</h2>
          <pre>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     NAVIGATEUR LOCAL                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Fichier â”‚â”€â”€â”€>â”‚ Sprint Review    â”‚â”€â”€â”€>â”‚ localStorage  â”‚  â”‚
â”‚  â”‚ CSV     â”‚    â”‚ Dashboard        â”‚    â”‚ (optionnel)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                  â”‚
â”‚                          v                                  â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                 â”‚ Affichage Ã©cran  â”‚                        â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           âœ— Aucun transfert rÃ©seau
                           âœ— Aucun serveur externe
                           âœ— Aucun cookie tiers</pre>

          <h3>Points clÃ©s</h3>
          <ul>
            <li><strong>Pas de backend</strong> : Aucune donnÃ©e n'est envoyÃ©e Ã  un serveur</li>
            <li><strong>Pas de tracking</strong> : Aucun outil d'analytics</li>
            <li><strong>Pas de cookies tiers</strong> : Uniquement localStorage navigateur</li>
            <li><strong>DonnÃ©es Ã©phÃ©mÃ¨res</strong> : Les donnÃ©es sont perdues Ã  la fermeture (sauf snapshot explicite)</li>
          </ul>

          <h2>4. ConformitÃ© par article RGPD</h2>
          <h3>Article 5 - Principes de traitement</h3>
          <table>
            <thead>
              <tr><th>Principe</th><th>ConformitÃ©</th><th>Commentaire</th></tr>
            </thead>
            <tbody>
              <tr><td>LicÃ©itÃ©, loyautÃ©, transparence</td><td>Conforme</td><td>Traitement local, visible par l'utilisateur</td></tr>
              <tr><td>Limitation des finalitÃ©s</td><td>Conforme</td><td>Uniquement pour Sprint Review</td></tr>
              <tr><td>Minimisation des donnÃ©es</td><td>Conforme</td><td>Seules les donnÃ©es Jira nÃ©cessaires</td></tr>
              <tr><td>Exactitude</td><td>Conforme</td><td>DonnÃ©es importÃ©es directement de Jira</td></tr>
              <tr><td>Limitation de conservation</td><td>Conforme</td><td>DonnÃ©es non persistÃ©es par dÃ©faut</td></tr>
            </tbody>
          </table>

          <h3>Article 17 - Droit Ã  l'effacement</h3>
          <table>
            <thead>
              <tr><th>MÃ©canisme</th><th>Disponible</th></tr>
            </thead>
            <tbody>
              <tr><td>Fermer le navigateur</td><td>DonnÃ©es en mÃ©moire effacÃ©es</td></tr>
              <tr><td>Vider le localStorage</td><td>Snapshots supprimÃ©s</td></tr>
              <tr><td>Ne pas importer les donnÃ©es</td><td>Aucun traitement</td></tr>
            </tbody>
          </table>

          <h2>5. Conclusion</h2>
          <p>Le Sprint Review Dashboard est <strong>conforme aux exigences RGPD</strong> grÃ¢ce Ã  son architecture 100% locale qui Ã©limine les risques liÃ©s au transfert et au stockage distant de donnÃ©es.</p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main id="app-main" class="main">
      <!-- Les pages seront montÃ©es ici -->

      <!-- Loading State Initial -->
      <div class="app-loader" id="app-initial-loader">
        <div class="loader"></div>
        <p>Chargement...</p>
      </div>
    </main>

    <!-- Notifications Container -->
    <div id="app-notifications" class="notifications-container" aria-live="polite">
      <!-- Notifications dynamiques -->
    </div>

  </div>

  <!-- Module JavaScript -->
  <script type="module" src="js/main.js"></script>

  <!-- Script d'initialisation (enlever le loader initial) -->
  <script>
    // Enlever le loader initial une fois que l'app est chargÃ©e
    document.addEventListener('DOMContentLoaded', function() {
      const loader = document.getElementById('app-initial-loader');
      if (loader) {
        setTimeout(function() {
          loader.style.opacity = '0';
          setTimeout(function() {
            loader.remove();
          }, 300);
        }, 100);
      }

      // Modal RGPD
      const rgpdBtn = document.getElementById('rgpd-info-btn');
      const rgpdModal = document.getElementById('rgpd-modal');
      const rgpdClose = document.getElementById('rgpd-modal-close');

      if (rgpdBtn && rgpdModal) {
        // Ouvrir la modal
        rgpdBtn.addEventListener('click', function() {
          rgpdModal.classList.add('modal-overlay--visible');
          document.body.style.overflow = 'hidden';
        });

        // Fermer avec le bouton X
        rgpdClose.addEventListener('click', function() {
          rgpdModal.classList.remove('modal-overlay--visible');
          document.body.style.overflow = '';
        });

        // Fermer en cliquant sur l'overlay
        rgpdModal.addEventListener('click', function(e) {
          if (e.target === rgpdModal) {
            rgpdModal.classList.remove('modal-overlay--visible');
            document.body.style.overflow = '';
          }
        });

        // Fermer avec Escape
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && rgpdModal.classList.contains('modal-overlay--visible')) {
            rgpdModal.classList.remove('modal-overlay--visible');
            document.body.style.overflow = '';
          }
        });
      }
    });

    // Enregistrer le plugin d'annotation pour Chart.js
    // Le plugin peut Ãªtre exposÃ© sous diffÃ©rents noms globaux
    if (window.Chart) {
      var annotationPlugin = window['chartjs-plugin-annotation'] ||
                             window.ChartAnnotation ||
                             (Chart.registry && Chart.registry.plugins.get('annotation'));

      if (annotationPlugin && typeof Chart.register === 'function') {
        try {
          Chart.register(annotationPlugin);
          console.log('[Chart.js] Plugin annotation enregistrÃ©');
        } catch (e) {
          console.warn('[Chart.js] Plugin annotation dÃ©jÃ  enregistrÃ© ou erreur:', e);
        }
      }
    }
  </script>

  <!-- Styles inline pour le loader initial (avant le chargement CSS) -->
  <style>
    .app-loader {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #f8fafc;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    .app-loader .loader {
      width: 48px;
      height: 48px;
      border: 4px solid #e2e8f0;
      border-top-color: #2563eb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .app-loader p {
      margin-top: 16px;
      color: #64748b;
      font-family: 'Inter', system-ui, sans-serif;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</body>
</html>
